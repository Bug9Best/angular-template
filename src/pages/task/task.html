<div class="flex flex-col bg-gray-300 h-screen p-3 gap-3">
  <div class="flex items-center justify-between h-16 w-full bg-white shadow-lg border border-gray-100 rounded-lg p-3">
    <div class="text-lg font-semibold"> งานที่ได้รับมอบหมาย</div>
    <p-button
      (onClick)="onCreate()"
      icon="pi pi-plus"
      label="เพิ่ม">
    </p-button>
  </div>

  <div class="h-full w-full bg-white shadow-lg border border-gray-100 rounded-lg p-3">
    <p-table
      [showGridlines]="true"
      [stripedRows]="true"
      [value]="listTasks">
      <ng-template #header>
        <tr>
          <th style="width: 50px;"></th>
          <th>ชื่อ</th>
          <th>คำอธิบาย</th>
          <th style="width: 200px;">วันครบกำหนด</th>
        </tr>
      </ng-template>
      <ng-template #body let-item>
        <tr>
          <td>
            <p-button
              (onClick)="onEdit(item)"
              severity="secondary"
              icon="pi pi-pencil"
              [text]="true">
            </p-button>
          </td>
          <td>{{ item.title }}</td>
          <td>{{ item.description }}</td>
          <td>{{ item.due_date | date: 'dd MMMM yyyy' }}</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

</div>

<p-dialog
  header="งานที่ได้รับมอบหมาย"
  [modal]="true"
  [(visible)]="dialogVisible"
  [style]="{ width: '50rem' }">

  <div [formGroup]="formGroup" class="flex flex-col gap-3">
    <div class="flex flex-col gap-1">
      <label for="title" class="required">ชื่อ</label>
      <input
        type="text"
        id="title"
        placeholder="ชื่อ"
        formControlName="title"
        pInputText/>
    </div>

    <div class="flex flex-col gap-1">
      <label for="due_date" class="required">วันครบกำหนด</label>
      <p-datepicker
        id="due_date"
        showIcon
        appendTo="body"
        dateFormat="dd/mm/yy"
        placeholder="วันครบกำหนด"  
        formControlName="due_date" />
    </div>

    <div class="flex flex-col gap-1">
      <label for="description">คำอธิบาย</label>
      <textarea
        id="description"
        rows="3"
        placeholder="คำอธิบาย"
        formControlName="description"
        pInputTextarea>
      </textarea>
    </div>

    <div class="flex justify-between gap-3 mt-3">
      <div class="flex">
        @if (formGroup.value.id) {
          <p-button
            [outlined]="true"
            icon="pi pi-trash"
            label="ลบ"
            severity="danger"          
            (onClick)="deleteTask()">
          </p-button>
        }
      </div>

      <div class="flex">
        <p-button
          label="บันทึก"
          icon="pi pi-save"
          (onClick)="formGroup.value.id ? updateTask() : createTask()"
          [disabled]="formGroup.invalid">
        </p-button>
      </div>
    </div>
  </div>
</p-dialog>
